%YAML 1.2
---
name: TOML
file_extensions:
  - toml
scope: source.toml
contexts:
  main:
    - include: comments
    - include: tables
    - include: keyval

  comments:
    - match: '#.*$'
      scope: comment.line.number-sign.toml

  tables:
    - match: '^\s*\[\[.*?\]\]'
      scope: entity.name.section.array.table.toml
    - match: '^\s*\[.*?\]'
      scope: entity.name.section.table.toml

  keyval:
    - match: '^\s*([A-Za-z0-9_\-.]+)\s*(=)\s*'
      captures:
        1: support.type.property-name.toml
        2: punctuation.separator.key-value.toml
      push:
        - meta_scope: meta.value.toml
        - include: values
        - match: '$'
          pop: true

  values:
    - include: strings
    - include: numbers
    - include: booleans
    - include: arrays
    - include: inline-table

  strings:
    - match: '"""'
      scope: punctuation.definition.string.begin.toml
      push:
        - meta_scope: string.quoted.triple.toml
        - match: '"""'
          scope: punctuation.definition.string.end.toml
          pop: true
        - match: '\\.'
          scope: constant.character.escape.toml
    - match: '"'
      scope: punctuation.definition.string.begin.toml
      push:
        - meta_scope: string.quoted.double.toml
        - match: '"'
          scope: punctuation.definition.string.end.toml
          pop: true
        - match: '\\.'
          scope: constant.character.escape.toml
    - match: "'"
      scope: punctuation.definition.string.begin.toml
      push:
        - meta_scope: string.quoted.single.toml
        - match: "'"
          scope: punctuation.definition.string.end.toml
          pop: true

  numbers:
    - match: '\b([+-]?\d+(_\d+)*\.?\d*([eE][+-]?\d+)?)\b'
      scope: constant.numeric.toml

  booleans:
    - match: '\b(true|false)\b'
      scope: constant.language.boolean.toml

  arrays:
    - match: '\['
      scope: punctuation.section.sequence.begin.toml
      push:
        - meta_scope: meta.sequence.toml
        - match: '\]'
          scope: punctuation.section.sequence.end.toml
          pop: true
        - include: values
        - match: ','
          scope: punctuation.separator.sequence.toml

  inline-table:
    - match: '\{'
      scope: punctuation.section.mapping.begin.toml
      push:
        - meta_scope: meta.mapping.toml
        - match: '\}'
          scope: punctuation.section.mapping.end.toml
          pop: true
        - match: '([A-Za-z0-9_\-.]+)\s*(=)'
          captures:
            1: support.type.property-name.toml
            2: punctuation.separator.key-value.toml
        - include: values
        - match: ','
          scope: punctuation.separator.mapping.toml

